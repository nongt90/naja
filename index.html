<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Happy Birthday! üéÇ</title>
    <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg: #fff5f8;
            --cake-pink: #ffc1e3;
            --cake-dark: #f48fb1;
            --cream: #ffffff;
            --candle: #fff176;
            --text: #ad1457;
        }

        body {
            background-color: var(--bg);
            font-family: 'Prompt', sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            overflow: hidden;
        }

        /* Container ‡∏´‡∏•‡∏±‡∏Å */
        .container {
            position: relative;
            text-align: center;
            width: 100%;
            max-width: 500px;
        }

        /* --- ‡∏î‡∏µ‡πÑ‡∏ã‡∏ô‡πå‡πÄ‡∏Ñ‡πâ‡∏Å --- */
        .cake-wrapper {
            position: relative;
            height: 300px;
            cursor: pointer;
            transition: transform 0.3s ease;
        }

        .cake-wrapper:hover { transform: scale(1.02); }

        .cake-body {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
        }

        /* ‡∏ä‡∏±‡πâ‡∏ô‡πÄ‡∏Ñ‡πâ‡∏Å */
        .tier {
            background: var(--cake-pink);
            margin: 0 auto;
            border-radius: 15px 15px 5px 5px;
            position: relative;
            border-bottom: 6px solid var(--cake-dark);
        }
        .tier-1 { width: 220px; height: 80px; z-index: 1; }
        .tier-2 { width: 160px; height: 70px; z-index: 2; margin-bottom: -10px; }
        .tier-3 { width: 100px; height: 60px; z-index: 3; margin-bottom: -10px; }

        /* ‡∏Ñ‡∏£‡∏µ‡∏°‡∏¢‡πâ‡∏≠‡∏¢ */
        .drip {
            position: absolute;
            top: 0; left: 10%; width: 80%; height: 20px;
            background: var(--cream);
            border-radius: 0 0 20px 20px;
        }

        /* --- ‡πÄ‡∏ó‡∏µ‡∏¢‡∏ô --- */
        .candles-container {
            position: absolute;
            top: -45px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 15px;
            z-index: 10;
        }

        .candle {
            width: 10px;
            height: 40px;
            background: linear-gradient(to bottom, #fff, var(--candle));
            border-radius: 3px;
            position: relative;
        }

        .flame {
            position: absolute;
            top: -18px;
            left: 50%;
            transform: translateX(-50%);
            width: 12px;
            height: 18px;
            background: #ffeb3b;
            border-radius: 50% 50% 35% 35%;
            box-shadow: 0 0 15px #ffd600;
            animation: flicker 0.2s infinite alternate;
        }

        @keyframes flicker {
            from { transform: translateX(-50%) scale(1) rotate(-2deg); }
            to { transform: translateX(-50%) scale(1.1) rotate(2deg); }
        }

        /* --- ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÅ‡∏•‡∏∞‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° --- */
        #status {
            margin-top: 40px;
            color: var(--text);
            font-weight: 600;
            background: #fff;
            padding: 10px 20px;
            border-radius: 50px;
            display: inline-block;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
        }

        #wish-section {
            display: none;
            opacity: 0;
            transition: all 1s ease;
        }

        .wish-card {
            background: white;
            padding: 40px;
            border-radius: 30px;
            box-shadow: 0 20px 40px rgba(244, 143, 177, 0.2);
        }

        h1 { color: var(--text); font-size: 2.2rem; margin: 0; }
        .fade-in { display: block !important; opacity: 1 !important; transform: translateY(-20px); }
        .hidden { display: none !important; }

    </style>
</head>
<body>

    <div class="container">
        <div id="cake-section">
            <div class="cake-wrapper" id="cake-tap">
                <div class="cake-body">
                    <div class="candles-container">
                        <div class="candle"><div class="flame"></div></div>
                        <div class="candle"><div class="flame"></div></div>
                        <div class="candle"><div class="flame"></div></div>
                    </div>
                    
                    <div class="tier tier-3"><div class="drip"></div></div>
                    <div class="tier tier-2"><div class="drip"></div></div>
                    <div class="tier tier-1"><div class="drip"></div></div>
                </div>
            </div>
            <div id="status">üëÜ ‡∏Å‡∏î‡∏ó‡∏µ‡πà‡πÄ‡∏Ñ‡πâ‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÉ‡∏ä‡πâ‡πÑ‡∏°‡∏Ñ‡πå</div>
        </div>

        <div id="wish-section">
            <div class="wish-card">
                <h1>üíñ Happy Birthday! üíñ</h1>
                <p style="color: #666; line-height: 1.6;">
                    ‡∏Ç‡∏≠‡πÉ‡∏´‡πâ‡∏õ‡∏µ‡∏ô‡∏µ‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏õ‡∏µ‡∏ó‡∏µ‡πà‡πÉ‡∏à‡∏î‡∏µ‡∏Å‡∏±‡∏ö‡πÄ‡∏ò‡∏≠<br>
                    ‡∏û‡∏ö‡πÄ‡∏à‡∏≠‡πÅ‡∏ï‡πà‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏£‡∏≤‡∏ß‡∏î‡∏µ‡πÜ ‡πÅ‡∏•‡∏∞‡∏£‡∏≠‡∏¢‡∏¢‡∏¥‡πâ‡∏°‡πÉ‡∏ô‡∏ó‡∏∏‡∏Å‡∏ß‡∏±‡∏ô‡∏ô‡∏∞
                </p>
                <div style="font-size: 40px; margin-top: 20px;">üéâ üéÅ üéÇ</div>
            </div>
        </div>
    </div>

    <script>
        const cakeTap = document.getElementById('cake-tap');
        const cakeSection = document.getElementById('cake-section');
        const wishSection = document.getElementById('wish-section');
        const flames = document.querySelectorAll('.flame');
        const statusText = document.getElementById('status');
        
        let audioContext;
        let analyser;
        let isBlown = false;

        async function startMic() {
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
                analyser = audioContext.createAnalyser();
                const microphone = audioContext.createMediaStreamSource(stream);
                
                analyser.fftSize = 512;
                microphone.connect(analyser);
                
                statusText.innerText = "‡∏à‡πà‡∏≠‡πÑ‡∏°‡∏Ñ‡πå‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏õ‡πà‡∏≤‡πÅ‡∏£‡∏á‡πÜ ‡πÄ‡∏•‡∏¢! üå¨Ô∏è";
                detectBlow();
            } catch (err) {
                statusText.innerText = "‚ùå ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡πÑ‡∏°‡∏Ñ‡πå‡πÑ‡∏î‡πâ";
            }
        }

        function detectBlow() {
            if (isBlown) return;

            const dataArray = new Uint8Array(analyser.frequencyBinCount);
            analyser.getByteFrequencyData(dataArray);

            let sum = 0;
            for (let i = 0; i < dataArray.length; i++) sum += dataArray[i];
            let average = sum / dataArray.length;

            // ‡∏ï‡∏£‡∏ß‡∏à‡∏à‡∏±‡∏ö‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡πÄ‡∏õ‡πà‡∏≤ (‡∏õ‡∏£‡∏±‡∏ö‡∏Ñ‡πà‡∏≤‡∏Ñ‡∏ß‡∏≤‡∏°‡πÑ‡∏ß‡∏ó‡∏µ‡πà 55-70)
            if (average > 65) { 
                extinguish();
            } else {
                requestAnimationFrame(detectBlow);
            }
        }

        function extinguish() {
            isBlown = true;
            flames.forEach(f => f.style.display = 'none');
            statusText.innerText = "‡πÄ‡∏¢‡πâ! ‡πÄ‡∏õ‡πà‡∏≤‡∏î‡∏±‡∏ö‡πÅ‡∏•‡πâ‡∏ß ‚ú®";

            setTimeout(() => {
                cakeSection.style.opacity = '0';
                setTimeout(() => {
                    cakeSection.classList.add('hidden');
                    wishSection.classList.add('fade-in');
                }, 800);
            }, 1000);
        }

        cakeTap.addEventListener('click', () => {
            if (!audioContext) startMic();
        });
    </script>
</body>
</html>
